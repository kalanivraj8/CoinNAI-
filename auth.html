<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login — CoinNAI</title>
<style>
  :root {
    --bg: #0d1523;
    --card-bg: linear-gradient(170deg, rgba(22, 38, 65, 0.8), rgba(15, 28, 48, 0.85));
    --muted: #a0afc7;
    --accent: #00c2a8;
    --red: #ffa6a6;
    --shadow: rgba(0, 194, 168, 0.2);
  }
  * {box-sizing:border-box;}
  body {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: linear-gradient(180deg, #001018, #0d1523);
    color: #dbe6f1;
    margin: 0; padding: 16px; min-height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  h1 {
    font-weight: 700;
    letter-spacing: 0.1em;
    color: var(--accent);
    margin-bottom: 8px;
  }
  .card {
    width: 100%; max-width: 400px;
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border-radius:14px; padding:24px;
    box-shadow:0 4px 15px rgba(0,0,0,0.25), 0 0 8px var(--shadow);
    border: 1px solid rgba(255,255,255,0.05);
  }
  label {font-weight:600;font-size:13px;color:var(--muted); display: block; margin-bottom: 4px; margin-top: 16px;}
  input, button {
    width: 100%; padding: 12px 14px;
    border-radius:10px; border: 1px solid rgba(255,255,255,0.08);
    background:rgba(255,255,255,0.05);
    color:#dbe6f1; font-weight:600;
    margin-top:10px; font-size:15px;
    transition: all 0.25s;
  }
  input:focus {
    outline:none;
    background:rgba(0,194,168,0.15);
    border-color: var(--accent);
  }
  button {
    cursor: pointer; background: var(--accent); border:none; color: var(--bg);
    font-weight: 700;
  }
  button:hover {background:#03b899; box-shadow: 0 0 10px var(--shadow);}
  button.secondary {
    background: transparent;
    border: 1px solid var(--muted);
    color: var(--muted);
  }
  button.secondary:hover { background: rgba(255,255,255,0.05); box-shadow: none; }
  .row { display:flex; gap:14px; margin-top:14px;}
  .col {flex:1;}
  #errorMsg {
    color: var(--red);
    background: rgba(255,100,100,0.1);
    padding: 10px;
    border-radius: 8px;
    border: 1px solid var(--red);
    font-weight: 600;
    text-align: center;
    margin-top: 16px;
    display: none; /* Hidden by default */
  }
  #loader {
    display: none; /* Hidden by default */
    text-align: center;
    padding: 20px;
    color: var(--accent);
    font-weight: 700;
  }
  .spinner {
    width:24px; height:24px; border-radius:50%;
    border:3px solid rgba(255,255,255,0.08);
    border-top-color: var(--accent);
    animation: spin 1s linear infinite; margin: 0 auto 10px auto;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<h1>CoinNAI</h1>
<div class="card">
  <div id="authForm">
    <label for="email">Email</label>
    <input id="email" type="email" placeholder="user@example.com" />
    
    <label for="password">Password</label>
    <input id="password" type="password" placeholder="••••••••" />
    
    <div id="errorMsg"></div>

    <div class="row">
      <div class="col"><button id="loginBtn">Login</button></div>
      <div class="col"><button id="registerBtn" class="secondary">Register</button></div>
    </div>
  </div>
  <div id="loader">
    <div class="spinner"></div>
    <div>Checking session...</div>
  </div>
</div>

<script type="module">
  // --- Firebase SDK ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword
  } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

  // --- SAME Firebase Config as index.html ---
  const firebaseConfig = {
    apiKey: "AIzaSyCYUpLjTSMQ-OvTexCymlLmfIw2KAn5rn8",
    authDomain: "coinnai.firebaseapp.com",
    projectId: "coinnai",
    storageBucket: "coinnai.firebasestorage.app",
    messagingSenderId: "619889316892",
    appId: "1:619889316892:web:b19240bbafa08fdd327bd9"
  };

  // --- Init Firebase ---
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // --- UI Elements ---
  const loginBtn = document.getElementById('loginBtn');
  const registerBtn = document.getElementById('registerBtn');
  const emailIn = document.getElementById('email');
  const passwordIn = document.getElementById('password');
  const errorMsg = document.getElementById('errorMsg');
  const authForm = document.getElementById('authForm');
  const loader = document.getElementById('loader');

  // --- Show/Hide Helpers ---
  function showLoader(isLoading) {
    loader.style.display = isLoading ? 'block' : 'none';
    authForm.style.display = isLoading ? 'none' : 'block';
  }
  function showError(message) {
    errorMsg.textContent = message;
    errorMsg.style.display = 'block';
  }

  // --- Auth Guard ---
  // If user is already logged in, redirect to index.html
  // If not, show the login form.
  onAuthStateChanged(auth, (user) => {
    if (user) {
      // User is logged in
      loader.querySelector('div + div').textContent = 'Success! Redirecting...';
      showLoader(true);
      window.location.href = "index.html"; // Redirect to main app
    } else {
      // User is logged out
      showLoader(false); // Show the login form
    }
  });

  // --- Login Button ---
  loginBtn.addEventListener('click', async () => {
    const email = emailIn.value;
    const password = passwordIn.value;
    if (!email || !password) {
      showError("Please enter both email and password.");
      return;
    }
    
    errorMsg.style.display = 'none';
    showLoader(true);
    loader.querySelector('div + div').textContent = 'Logging in...';

    try {
      await signInWithEmailAndPassword(auth, email, password);
      // Success. onAuthStateChanged listener will handle the redirect.
    } catch (error) {
      showLoader(false);
      showError(error.message); // Show Firebase error
    }
  });

  // --- Register Button ---
  registerBtn.addEventListener('click', async () => {
    const email = emailIn.value;
    const password = passwordIn.value;
    if (!email || password.length < 6) {
      showError("Please enter email and a password (min. 6 chars).");
      return;
    }
    
    errorMsg.style.display = 'none';
    showLoader(true);
    loader.querySelector('div + div').textContent = 'Creating account...';

    try {
      await createUserWithEmailAndPassword(auth, email, password);
      // Success. onAuthStateChanged listener will handle the redirect.
    } catch (error) {
      showLoader(false);
      showError(error.message); // Show Firebase error (e.g., email-in-use)
    }
  });

</script>
</body>
</html>
